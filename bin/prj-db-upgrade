#!/usr/bin/php

<?php
  //

  $myargs = $argv;
  $argv = [];
  $argc = 0;

  // require_once(__DIR__ . "/../vendor/autoload.php");
  require_once(__DIR__ . "/../config.php");
  require_once(__DIR__ . "/lib/Database.php");

  global $myconfig;

  $db = new \Jehon\Maintenance\Database(
      "mysql:host=127.0.0.1;port=5556;dbname={$myconfig['database']['schema']}",
      $myconfig['database']['rootuser'],
      $myconfig['database']['rootpwd']
    );

  if (count($myargs) > 1) {
    $db->runFileOrDirectory($myargs[1]);
  } else {
    $db->runDirectory(__DIR__ . "/../conf/database/versions/");
    $db->runDirectory(__DIR__ . "/../conf/database/always/");
  }
