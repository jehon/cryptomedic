#!/bin/bash

set -e
set -x

DBNAME=$(php $PRJ_DIR/config.php 'database.schema')
DBUSER=$(php $PRJ_DIR/config.php 'database.username')
DBPASS=$(php $PRJ_DIR/config.php 'database.password')

$MYSQL --database=mysql <<-EOC
  DROP SCHEMA IF EXISTS $DBNAME;
  CREATE SCHEMA $DBNAME;
  USE $DBNAME;
  GRANT ALL PRIVILEGES ON $DBNAME   TO $DBUSER;
  GRANT ALL PRIVILEGES ON $DBNAME.* TO $DBUSER;
  SET PASSWORD FOR $DBUSER = PASSWORD('$DBPASS');
EOC

# Mysql 5.7, 7.0:
# ALTER USER 'root' IDENTIFIED WITH mysql_native_password BY 'password';
# ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'password';
