#!/usr/bin/env bash

set -o errexit
set -o pipefail

export CR_SCRIPT_DIR
export CR_PRJ_DIR
export CR_TMP
export SSH_KNOWN_HOSTS="$HOME/.ssh/known_hosts"

export DEBIAN_FRONTEND=noninteractive

#
# Initialize
#
CR_SCRIPT_DIR="$(realpath "$(dirname "${BASH_SOURCE[0]}")")"
CR_PRJ_DIR="$(dirname "$CR_SCRIPT_DIR")"
CR_TMP="$CR_PRJ_DIR/tmp"

export PATH="$CR_SCRIPT_DIR:$PATH"

# For recursion
export CR_HEADER_PREFIX="*$CR_HEADER_PREFIX"

cr_curl() {
    curl -fsSL --user-agent firefox "$@"
}

jh_color() {
    COLOR=${1:-"0"}
    if [ -z "$JH_DAEMON" ]; then
        echo -en "\e[${COLOR}m"
    fi
}

header_message() {
    if [ -n "$QUIET" ]; then
        return
    fi
    jh_color 93
    echo -n "$CR_HEADER_PREFIX $*"
    jh_color
    echo
}

header_begin() {
    LASTMSG="$*"
    header_message "$*..."
}

header_end() {
    header_message "$LASTMSG done"
}
