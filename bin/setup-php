#!/usr/bin/env bash

set -o errexit

# shellcheck source=/usr/bin/jh-lib
. jh-lib

PHP_VERSION="$1"
if [ -z "$PHP_VERSION" ]; then
    jh-fatal "Specify php version as [1]"
fi

export DEBIAN_FRONTEND=noninteractive

# See https://php.watch/articles/install-php81-ubuntu-debian
# Alternative: https://www.cloudbooklet.com/how-to-install-or-upgrade-php-8-1-on-debian/

#
# Configure the repository
#
wget -O /etc/apt/trusted.gpg.d/php.gpg https://packages.sury.org/php/apt.gpg
echo "deb https://packages.sury.org/php/ $(lsb_release -sc) main" > /etc/apt/sources.list.d/php.list

apt update --quiet --yes

# Install php
apt install --quiet --yes \
    "php${PHP_VERSION}-pdo-mysql" \
    "php${PHP_VERSION}-cli" \
    "php${PHP_VERSION}-curl" \
    "php${PHP_VERSION}-xml" \
    "php${PHP_VERSION}-xdebug"

# && { \
# echo "xdebug.mode=debug"; \
# } > /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini;
# && echo "xdebug.remote_enable=on" >> /usr/local/etc/php/conf.d/xdebug.ini \
# && echo "xdebug.remote_autostart=off" >> /usr/local/etc/php/conf.d/xdebug.ini


# Install composer.phar at /composer.phar
( cd / && curl --silent --show-error https://getcomposer.org/installer | php )
