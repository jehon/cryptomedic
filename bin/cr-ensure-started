#!/usr/bin/env bash

set -o errexit
set -o pipefail

# shellcheck source=./cr-lib
. "$(dirname "${BASH_SOURCE[0]}")"/cr-lib

# if ! docker compose ps --filter "status=running" | grep " server " &>/dev/null; then
if ! cr-docker-compose ps --filter "status=running" | grep " server " &>/dev/null; then
	header_begin "starting docker"
	cr-capture-output \
		cr-docker-compose up --build -d
	header_end
fi

# Check folders
header_begin "Add folders if necessary"
cr-ensure-folder-empty "www/api/${CR_API_VERSION}/bootstrap/cache"
cr-ensure-folder-empty "www/api/${CR_API_VERSION}/storage/framework/cache"
cr-ensure-folder-empty "www/api/${CR_API_VERSION}/storage/framework/sessions"
header_end
