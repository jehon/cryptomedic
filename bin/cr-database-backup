#!/usr/bin/env bash

set -o errexit
set -o pipefail

# shellcheck source=./cr-lib
. "$(dirname "${BASH_SOURCE[0]}")"/cr-lib

OUTPUT="$CR_TMP/cryptomedic-$(date +%F-%H-%M-%S.%N)"

cr-ensure-started
mkdir -p "$(dirname "$OUTPUT")"

(
    cr-docker-compose exec -T \
        "mysql" \
        mysqldump --user=root --password=root cryptomedic

) >"$OUTPUT"

echo
echo "Backup available at $OUTPUT"
