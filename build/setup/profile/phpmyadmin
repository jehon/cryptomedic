#!/usr/bin/env bash

echo -n "Wait for mysql to come online"
while ! mysql --database=mysql -e 'Show tables;' &>/dev/null; do 
    sleep 1
    echo -n "."
done
echo " done"

#
# We don't have a "IF EXISTS" in mysql < 7.0
#
mysql --database mysql -e "DELETE FROM mysql.user WHERE user = 'pma'" || true
cat <<EOS | mysql --database=mysql
    CREATE USER 'pma'@'localhost' IDENTIFIED BY 'pma';
    GRANT ALL PRIVILEGES ON *.* TO 'pma'@'localhost';
EOS
