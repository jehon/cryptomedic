# https://hub.docker.com/_/php/

FROM ubuntu:18.04

WORKDIR /app

RUN apt update

# enable some extensions
RUN DEBIAN_FRONTEND=noninteractive apt install -y \
	curl \
	apache2 php libapache2-mod-php php-mysql \
	php-curl php-gd php-intl php-json php-mbstring php-xml php-zip \
	ssmtp

#    libfreetype6-dev libjpeg62-turbo-dev libmcrypt-dev libpng-dev

	# && docker-php-ext-configure gd --with-freetype-dir=/usr/include/ --with-jpeg-dir=/usr/include/ \
    # && docker-php-ext-install -j$(nproc) gd

# RUN pecl install xdebug-2.6.0 \
# 	&& docker-php-ext-enable xdebug  \
# RUN docker-php-ext-install pdo_mysql
RUN a2enmod expires rewrite

# AllowOverride all

RUN sed -ri -e 's!/var/www/html!/app/www!g' /etc/apache2/sites-available/*.conf
# RUN sed -ri -e 's!/var/www/!/app/www!g' /etc/apache2/apache2.conf 
# RUN sed -ri -e 's!/var/www/!/app/www!g' /etc/apache2/conf-available/*.conf
COPY conf/custom.conf /etc/apache2/conf-enabled/

RUN curl -s https://getcomposer.org/installer | php
RUN mv composer.phar /usr/local/bin/composer

COPY conf/ssmtp.conf /etc/ssmtp/ssmtp.conf

# https://stackoverflow.com/a/49765176/1954789
CMD apachectl -D FOREGROUND
