<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module name="jh-authorized">
  <template>
    <span id='translating' hidden$="[[!isAuthorized(value, authorizedList, inversed)]]">
      <content></content>
    </span>
  </template>

  <script>
    /* global jQuery */
    /* exported setAuthorizedObject */

    let setAuthorizedObject_cb = jQuery.Callbacks();
    let setAuthorizedObject_list = [];

    function setAuthorizedObject(authorizedObject = null) {
      let list = (authorizedObject ? Object.keys(authorizedObject) : []);
      setAuthorizedObject_cb.fire(list);
      setAuthorizedObject_list = list;
    }

    Polymer({
      is: 'jh-authorized',

      // https://www.polymer-project.org/1.0/docs/devguide/properties
      properties: {
        value: {
          type:               String,
          readonly:           true,
          value:              "application.open"
        },
        inversed: {
          type:               Boolean,
          readonly:           true,
          value:              false
        },
        // authorizedList: {
        //   type:               Array,
        //   value:              []
        // }
      },

      ready: function() {
        setAuthorizedObject_cb.add((list) => { this.setAuthorizedList(list) });
        this.setAuthorizedList(setAuthorizedObject_list);
      },

      setAuthorizedList: function(authorizedList) {
        // Set it in two steps, to enable trigger of update
        this.authorizedList = null;
        this.authorizedList = authorizedList;
      },

      isAuthorized(value, authorizedList, inversed) {
        if (inversed) {
          console.log("inversed test: ", value);
          return !this.isAuthorized(value, authorizedList, false);
        }
        if (authorizedList == null) {
          return false;
        }
        return authorizedList.indexOf(value) >= 0;
      }
    });
  </script>
</dom-module>
