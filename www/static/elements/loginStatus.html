<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/fetchfull-elements/src/fetchfull-element.html">

<dom-module name="cryptomedic-login-status">
  <template>
    <span hidden$=[[!username]]>
      <!-- sync status -->
      <span hidden$="[[remaining]]">
        <img id="sync-ok" src='resources/sync-ok.png'>
        <paper-tooltip>Sync finished, all up-to-date.</paper-tooltip>
      </span>
      <span hidden$="[[!remaining]]">
        <img id="sync-download" src='resources/sync-download.png'>
        <paper-tooltip for='sync-download'>Downloading items</paper-tooltip>
        [[remaining]]
      </span>

      <!-- login status -->
      <span>
        <span id='login_loggedusername'>[[username]]</span>
        <img id='logout' src="resources/logout.gif"/>
        <paper-tooltip for='logout'>Logout [[username]]</paper-tooltip>
      </span>
      <cryptomedic-data-service id='service'></cryptomedic-data-service>
    </span>
  </template>

  <script>
    (function() {
      Polymer({
        is: 'cryptomedic-login-status',

        properties: {},

        listeners: {
          'logout.tap': 'doLogout'
        },

        attached() {
          this.remaining = false;
          this.username = false;

          // Let's react to info about the user
          this.$.service.userCb.add((data) => {
            if (data) {
              this.username = data.username;
            } else {
              this.username = false;
            }
          });

          // Let's react to info about the sync
          this.$.service.syncRemainingCb.add((data) => {
            this.remaining = data;
          });

          // Let's check the login directly
          this.$.service.doLoginCheck();

        },

        doLogout() {
          this.$.service.doLogout();
        }
      })
    })();
  </script>
</dom-module>
